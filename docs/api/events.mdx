---
sidebar_position: 3
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Events

[NPM](https://npmjs.com/package/@civet/events) | [GitHub](https://github.com/civet-org/events)

```bash
npm install @civet/events
```

The events module provides advanced event handling functionality.

The [`DataProvider`](core#dataprovider) already has basic support for handling events. However, it is limited to updating all subscribers of a specific resource.
If you need more advanced event handling, this is the place to go.

## `ConfigContext`

React context for providing shared configuration to event components.

### Context

| Name          | Type                              | Description |
| ------------- | --------------------------------- | ----------- |
| eventReceiver | [`EventReceiver`](#eventreceiver) |             |

### Related

[`<ConfigProvider>`](#configprovider), [`<ConfigConsumer>`](#configconsumer), [`useConfigContext`](#useconfigcontext)

## `<ConfigProvider>`

Context provider for the [`ConfigContext`](#configcontext).

<Tabs>
  <TabItem value="usage" label="Usage" default>
    ```jsx
    <ConfigProvider eventReceiver={receiver}>...</ConfigProvider>
    ```
  </TabItem>

  <TabItem value="import" label="Import">
    ```js
    import { ConfigProvider } from "@civet/events";
    ```
  </TabItem>
</Tabs>

### Props

| Name          | Type                              | Description |
| ------------- | --------------------------------- | ----------- |
| eventReceiver | [`EventReceiver`](#eventreceiver) |             |

### Related

[`ConfigContext`](#configcontext), [`<ConfigConsumer>`](#configconsumer), [`useConfigContext`](#useconfigcontext)

## `<ConfigConsumer>`

Context consumer for the [`ConfigContext`](#configcontext).

<Tabs>
  <TabItem value="usage" label="Usage" default>
    ```jsx
    <ConfigConsumer>
      {(context) => ...}
    </ConfigConsumer>
    ```
  </TabItem>

  <TabItem value="import" label="Import">
    ```js
    import { ConfigConsumer } from "@civet/events";
    ```
  </TabItem>
</Tabs>

### Related

[`ConfigContext`](#configcontext), [`<ConfigProvider>`](#configprovider), [`useConfigContext`](#useconfigcontext)

## `useConfigContext`

Context consumer for the [`ConfigContext`](#configcontext).

<Tabs>
  <TabItem value="usage" label="Usage" default>
    ```js
    const context = useConfigContext();
    ```
  </TabItem>

  <TabItem value="import" label="Import">
    ```js
    import { useConfigContext } from "@civet/events";
    ```
  </TabItem>
</Tabs>

### Function arguments

None

### Return type

| Type     | Description                       |
| -------- | --------------------------------- |
| `object` | [ConfigContext](#configcontext) |

### Related

[`ConfigContext`](#configcontext), [`<ConfigProvider>`](#configprovider), [`<ConfigConsumer>`](#configconsumer)

## `<EventHandler>`

Subscribes to an [`EventReceiver`](#eventreceiver) to update a [`<Resource>`](core#resource) when events occur.

Necessary configuration that is not directly specified is taken from the nearest [`<ConfigProvider>`](#configprovider) and [`<Resource>`](core#resource).

You can specify which events should lead to an update by either passing `options` to the [`EventReceiver`](#eventreceiver) or using `onEvent`.
`onEvent` can also be used to directly access events allowing you to add custom event logic to your components.

Additionally, you can use `onNotify` which is called when the [`<Resource>`](core#resource) has been asked to update and allows you to get all events that have lead to the update at once as well as the request and revision for the update.

<Tabs>
  <TabItem value="usage" label="Usage" default>
    ```jsx
    <EventHandler
      options={{ some: "options" }}
      onEvent={(e) => console.log("Received", e)}
    >
      ...
    </Resource>
    ```
  </TabItem>

  <TabItem value="import" label="Import">
    ```js
    import { EventHandler } from "@civet/events";
    ```
  </TabItem>
</Tabs>

### Props

| Name          | Type                                                             | Description                                                                                                                                          |
| ------------- | ---------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| eventReceiver | [`EventReceiver`](#eventreceiver)                                | [`EventReceiver`](#eventreceiver) to be used                                                                                                         |
| resource      | `object`                                                         | [Resource context](core#resourceprovider) to be used                                                                                                 |
| options       | `object`                                                         | [`EventReceiver`](#eventreceiver) options                                                                                                            |
| onEvent       | `(event: any) => boolean`                                        | Callback to filter events and handle your own event logic - if `true` is returned, the event is considered as handled and the resource is not update |
| onNotify      | `({ request: string, revision: string }, events: any[]) => void` | Informs when the [`<Resource>`](core#resource) has been requested to update                                                                          |

## `composeHandlers`

Utility for composing multiple event handlers.
Invokes each handler from left to right, but stops immediately when a handler returns `true`.

<Tabs>
  <TabItem value="usage" label="Usage" default>
    ```js
    const composedHandler = composeHandlers(
      (event) => console.log('Received', event),
      (event) => ...
    );
    ```
  </TabItem>

  <TabItem value="import" label="Import">
    ```js
    import { composeHandlers } from "@civet/events";
    ```
  </TabItem>
</Tabs>

### Function arguments

| Name        | Type                      | Description    |
| ----------- | ------------------------- | -------------- |
| ...handlers | `(event: any) => boolean` | Event handlers |

### Return type

| Type                      | Description       |
| ------------------------- | ----------------- |
| `(event: any) => boolean` | Composed handlers |

## `EventReceiver`

EventReceiver base class.

<Tabs>
  <TabItem value="usage" label="Usage" default>
    ```js
    class CustomReceiver extends EventReceiver {
      handleSubscribe(resource, options, handler) {
        ...
        const unsubscribe = () => {
          ...
        };
        return unsubscribe;
      }
    }

    const receiver = new CustomReceiver();
    ```
  </TabItem>

  <TabItem value="import" label="Import">
    ```js
    import { EventReceiver } from "@civet/events";
    ```
  </TabItem>
</Tabs>

### Class members

| Name      | Arguments                                                                 | Return Type               | Description         |
| --------- | ------------------------------------------------------------------------- | ------------------------- | ------------------- |
| subscribe | resource: `object`, options: `object`, handler: `(events: any[]) => void` | unsubscribe: `() => void` | Subscribe to events |

### Abstract members

| Name            | Arguments                                                                 | Return Type               | Description |
| --------------- | ------------------------------------------------------------------------- | ------------------------- | ----------- |
| handleSubscribe | resource: `object`, options: `object`, handler: `(events: any[]) => void` | unsubscribe: `() => void` |             |

### Caveats

#### Abstract functions

The function `subscribe` internally invokes its abstract counterpart `handleSubscribe` and performs generic validation on its parameters and return value. Therefore, you should not just override it, but implement the abstract `handleSubscribe` method instead.

## `isEventReceiver`

Identifies [`EventReceiver`](#eventreceiver) instances.

<Tabs>
  <TabItem value="usage" label="Usage" default>
    ```js
    const er = new EventReceiver();

    if (!isEventReceiver(er)) {
      throw new Error("Should be a EventReceiver instance");
    }
    ```
  </TabItem>

  <TabItem value="import" label="Import">
    ```js
    import { isEventReceiver } from "@civet/events";
    ```
  </TabItem>
</Tabs>

### Function arguments

| Name          | Type  | Description              |
| ------------- | ----- | ------------------------ |
| eventReceiver | `any` | The object to be checked |

### Return type

| Type      | Description                                                                 |
| --------- | --------------------------------------------------------------------------- |
| `boolean` | Whether `eventReceiver` is an instance of [`EventReceiver`](#eventreceiver) |

## `eventReceiverPropType`

PropType for [`EventReceiver`](#eventreceiver) instances.

<Tabs>
  <TabItem value="usage" label="Usage" default>
    ```js
    const propTypes = {
      optional: eventReceiverPropType,
      required: eventReceiverPropType.isRequired,
    };
    ```
  </TabItem>

  <TabItem value="import" label="Import">
    ```js
    import { eventReceiverPropType } from "@civet/events";
    ```
  </TabItem>
</Tabs>
